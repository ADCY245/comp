{% extends 'admin/base.html' %}

{% block title %}Manage Company Assignments - Admin Panel{% endblock %}

{% block extra_css %}
<style>
    .company-badge {
        max-width: 150px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: inline-block;
        vertical-align: middle;
    }
    .badge-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
    }
    .table-responsive {
        min-height: 300px;
    }
    .pagination {
        margin-bottom: 0;
    }
    /* Modal styles */
    .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.5);
    }
    .modal.show {
        display: block;
        background-color: rgba(0, 0, 0, 0.5);
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-building me-2"></i>Manage Company Assignments</h2>
    <div>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
        </a>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">User Company Assignments</h3>
            <div class="input-group" style="max-width: 300px;">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="form-control" 
                    placeholder="Search users..."
                    value=""
                >
                <button class="btn btn-outline-secondary" type="button" id="searchButton">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- React Component will be mounted here -->
    <div id="userCompanyManager"></div>
</div>
{% endblock %}

{% block extra_js %}
<!-- React and ReactDOM -->
<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<!-- Babel for JSX -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<!-- React Toastify -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/react-toastify/8.1.0/react-toastify.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-toastify/8.1.0/react-toastify.js"></script>

<!-- Our React Component -->
<script type="text/babel" src="{{ url_for('static', filename='js/components/admin/UserCompanyManager.js') }}"></script>

<script type="text/babel">
    // Wait for the document to be ready
    document.addEventListener('DOMContentLoaded', function() {
        // Add active class to the current nav item
        const currentNavItem = document.querySelector('.navbar-nav .nav-link[href="{{ url_for(\'manage_company_assignments\') }}"]');
        if (currentNavItem) {
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            currentNavItem.classList.add('active');
        }
        
        // Initialize the React component
        const container = document.getElementById('userCompanyManager');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(UserCompanyManager, null));
        
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        
        const handleSearch = () => {
            const searchTerm = searchInput.value.trim();
            // This will be handled by the React component's state
            // The component will re-render with the new search term
            const searchParams = new URLSearchParams(window.location.search);
            searchParams.set('search', searchTerm);
            window.location.href = '?' + searchParams.toString();
        };
        
        searchButton.addEventListener('click', handleSearch);
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });
    });
</script>
{% endblock %}
